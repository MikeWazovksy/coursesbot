# ü§ñ Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–æ–≤

–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–æ–≤ —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ÆKassa.

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- üéì **–ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ü–µ–Ω–∞–º–∏.
- üí≥ **–ü–æ–∫—É–ø–∫–∞** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ÆKassa (—á–µ—Ä–µ–∑ Telegram Payments).
- ‚è± **–ê–≤—Ç–æ–æ—Ç–º–µ–Ω–∞ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤** ‚Äî –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª –æ–ø–ª–∞—Ç—É –∑–∞ 10 –º–∏–Ω—É—Ç, –∑–∞–∫–∞–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è.
- ü§ñ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–¥–∞—á–∞ –¥–æ—Å—Ç—É–ø–∞** ‚Äî –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –±–æ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –∫—É—Ä—Å–∞.
- üìö **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç** ‚Äî —Ä–∞–∑–¥–µ–ª—ã "–ú–æ–∏ –∫—É—Ä—Å—ã" –∏ "–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫".

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

- üîê **–ó–∞—â–∏—â—ë–Ω–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** ‚Äî –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è ID –∏–∑ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.
- ‚ûï **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏ (CRUD)**
- üë• **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ–∫—É–ø–∫–∏, –¥–æ—Ö–æ–¥.
- üõ°Ô∏è **–¢—Ä–æ—Ç—Ç–ª–∏–Ω–≥** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞.

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Python 3.10+**
- **Aiogram 3** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API
- **AIOHTTP** ‚Äî –≤–µ–±—Ö—É–∫–∏
- **asyncpg** ‚Äî PostgreSQL
- **–ÆKassa —á–µ—Ä–µ–∑ Telegram Payment API**
- **Nginx, Gunicorn, systemd** ‚Äî –¥–µ–ø–ª–æ–π –Ω–∞ VPS

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
coursesbot/
‚îÇ‚îÄ‚îÄ bot.py
‚îÇ‚îÄ‚îÄ config.py
‚îÇ‚îÄ‚îÄ database.py
‚îÇ‚îÄ‚îÄ requirements.txt
‚îÇ‚îÄ‚îÄ .env
‚îÇ‚îÄ‚îÄ .gitignore
‚îÇ‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îî‚îÄ‚îÄ admin.py
‚îÇ
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ user_kb.py
‚îÇ   ‚îî‚îÄ‚îÄ admin_kb.py
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îú‚îÄ‚îÄ courses.py
‚îÇ   ‚îú‚îÄ‚îÄ payments.py
‚îÇ   ‚îú‚îÄ‚îÄ user_courses.py
‚îÇ   ‚îî‚îÄ‚îÄ stats.py
‚îÇ
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 001_init.sql
‚îÇ   ‚îî‚îÄ‚îÄ 002_add_indexes.sql
‚îÇ
‚îú‚îÄ‚îÄ states/
‚îÇ   ‚îî‚îÄ‚îÄ admin_states.py
‚îÇ
‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îî‚îÄ‚îÄ throttling.py
‚îÇ
‚îî‚îÄ‚îÄ filters/
    ‚îî‚îÄ‚îÄ admin.py
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone <URL-–≤–∞—à–µ–≥–æ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
cd <–Ω–∞–∑–≤–∞–Ω–∏–µ-–ø–∞–ø–∫–∏-–ø—Ä–æ–µ–∫—Ç–∞>
```

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**Windows**:

```bash
python -m venv venv
venv\Scripts\activate
```

**macOS / Linux**:

```bash
python3 -m venv venv
source venv/bin/activate
```

### 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### 4Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ:

```ini
BOT_TOKEN="..."
ADMIN_IDS="..."
PAYMENT_PROVIDER_TOKEN="..."
DATABASE_URL="postgresql://user:password@localhost:5432/dbname"
```

### 5Ô∏è‚É£ Production –Ω–∞ Render.com

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ –Ω–∞ GitHub.
2. –°–æ–∑–¥–∞–π—Ç–µ Web Service, –ø–æ–¥–∫–ª—é—á–∏–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## ‚òÅÔ∏è Production –Ω–∞ VPS (Ubuntu 22.04)

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–æ–º–µ–Ω–∞, —É–∫–∞–∑—ã–≤–∞—é—â–µ–≥–æ –Ω–∞ IP –≤–∞—à–µ–≥–æ VPS.

---

### üîπ 1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
ssh root@–í–ê–®_IP_–ê–î–†–ï–°
adduser your_user
usermod -aG sudo your_user
ufw allow OpenSSH
ufw allow 'Nginx Full'
ufw enable
ssh your_user@–í–ê–®_IP_–ê–î–†–ï–°
```

---

### üîπ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

```bash
sudo apt update
sudo apt install postgresql postgresql-contrib -y
```

–°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—É:

```bash
sudo -u postgres psql
```

–í–Ω—É—Ç—Ä–∏ PostgreSQL:

```sql
CREATE DATABASE coursesbot;
CREATE USER botuser WITH PASSWORD 'strongpassword';
ALTER ROLE botuser SET client_encoding TO 'utf8';
ALTER ROLE botuser SET default_transaction_isolation TO 'read committed';
ALTER ROLE botuser SET timezone TO 'UTC';
GRANT ALL PRIVILEGES ON DATABASE coursesbot TO botuser;
\q
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

```bash
psql -U botuser -d coursesbot -h 127.0.0.1 -W
```

---

### üîπ 3. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

```bash
sudo apt install python3-pip python3-venv git -y
git clone https://github.com/–≤–∞—à_–ª–æ–≥–∏–Ω/–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.git
cd –≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
nano .env
```

---

### üîπ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
sudo nano /etc/nginx/sites-available/your_bot
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º:

```bash
sudo ln -s /etc/nginx/sites-available/your_bot /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

### üîπ 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd

```bash
sudo nano /etc/systemd/system/your_bot.service
```

**–í–∞—Ä–∏–∞–Ω—Ç –±–µ–∑ Gunicorn:**

```
[Unit]
Description=Telegram Course Bot
After=network.target

[Service]
User=your_user
WorkingDirectory=/home/your_user/–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
ExecStart=/home/your_user/–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/venv/bin/python bot.py
Restart=always

[Install]
WantedBy=multi-user.target
```

**–í–∞—Ä–∏–∞–Ω—Ç —Å Gunicorn (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è):**

```
ExecStart=/home/your_user/–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/venv/bin/gunicorn --workers 4 --worker-class aiohttp.GunicornWebWorker bot:app
```

–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º:

```bash
sudo systemctl daemon-reload
sudo systemctl enable your_bot.service
sudo systemctl start your_bot.service
sudo systemctl status your_bot.service
```

---

### üîπ 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS (Certbot)

```bash
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx
sudo systemctl restart nginx
sudo systemctl restart your_bot.service
```

---

## üïπÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- `/start` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- –ú–µ–Ω—é ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å–∞–º, –ø–æ–∫—É–ø–∫–∏, –∏—Å—Ç–æ—Ä–∏—è

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

- `/admin` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

---

## üíñ –î–æ–Ω–∞—Ç—ã

–ï—Å–ª–∏ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –ø—Ä–æ–µ–∫—Ç:

- **BTC:** `bc1qa3c5xdc6a3n2l3w0sq3vysustczpmlvhdwr8vc`

–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É! üôè
